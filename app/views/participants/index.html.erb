<p id="notice"><%= notice %></p>

<h1>User List</h1>
<table>
  <thead>
    <tr>
      <th>User</th>
      <th>State</th>
      <th>Chat room</th>
      <th colspan="3"></th>
    </tr>
  </thead>
  
  <% @chat_rooms=ChatRoom.order("id ASC")%>
  <% @chat_rooms.each do |cr| %>
  <%=cr.name %>
  <%end%>
  <% @users= User.order("id ASC")%>
  <% @participants= Participant.order(user_id:"ASC",chat_room_id:"ASC")%>
  
  <tbody>
    <% @users.each do |user| %>
    	<% @bool=true%>
    	<tr>
	    <td><%= user.name %></td>
	    <td><% if(user.online)%>
	     	online
	     	<% @participants.each do |participant| %>
	     		<%if(user.id==participant.user.id)then%>
			     	<%if(!@bool)then%>
				     	<tr><td></td> <td></td>
			     	<%end%>
			     	<%@bool=false%>
			        <td><%= participant.chat_room.name %></td>
			        <td><%= link_to 'Destroy', participant, method: :delete, data: { confirm: 'Are you sure?' } %></td>
			        </tr>
			    <%end%>
		    <% end %>
	    <% else%>
	      	offline</tr>
	    <% end%>
    <% end %>
  </tbody>
</table>

<br>

<%= link_to 'New Participant', new_participant_path %>
